{"ast":null,"code":"import * as StellarSdk from '@stellar/stellar-sdk';\nconst TESTNET = true;\nconst SERVER_URL = TESTNET ? 'https://horizon-testnet.stellar.org' : 'https://horizon.stellar.org';\nconst NETWORK_PASSPHRASE = TESTNET ? StellarSdk.Networks.TESTNET : StellarSdk.Networks.PUBLIC;\nclass StellarService {\n  constructor() {\n    this.server = new StellarSdk.Horizon.Server(SERVER_URL);\n  }\n  async createTimeLock(secretKey, amount, lockPeriodDays) {\n    try {\n      const sourceKeypair = StellarSdk.Keypair.fromSecret(secretKey);\n      const sourcePublicKey = sourceKeypair.publicKey();\n\n      // Load account\n      const account = await this.server.loadAccount(sourcePublicKey);\n\n      // Calculate unlock time\n      const unlockTime = Math.floor(Date.now() / 1000) + lockPeriodDays * 24 * 60 * 60;\n\n      // Build transaction\n      const transaction = new StellarSdk.TransactionBuilder(account, {\n        fee: StellarSdk.BASE_FEE,\n        networkPassphrase: NETWORK_PASSPHRASE\n      }).addOperation(StellarSdk.Operation.payment({\n        destination: sourcePublicKey,\n        asset: StellarSdk.Asset.native(),\n        amount: amount.toString()\n      })).addMemo(StellarSdk.Memo.text(`TIMELOCK:${unlockTime}`)).setTimeout(30).build();\n\n      // Sign and submit\n      transaction.sign(sourceKeypair);\n      const result = await this.server.submitTransaction(transaction);\n      return result.hash;\n    } catch (error) {\n      console.error('Stellar transaction error:', error);\n      throw new Error(error.message || 'Failed to create time-lock');\n    }\n  }\n\n  // --- Freighter integration ---\n  isFreighterAvailable() {\n    return typeof window !== 'undefined' && !!window.freighterApi;\n  }\n  async getFreighterPublicKey() {\n    if (!this.isFreighterAvailable()) throw new Error('Freighter not available');\n    return await window.freighterApi.getPublicKey();\n  }\n\n  // Build transaction but do not sign (returns Stellar Transaction object)\n  async buildTimeLockTransaction(publicKey, amount, lockPeriodDays) {\n    const account = await this.server.loadAccount(publicKey);\n    const unlockTime = Math.floor(Date.now() / 1000) + lockPeriodDays * 24 * 60 * 60;\n    const transaction = new StellarSdk.TransactionBuilder(account, {\n      fee: StellarSdk.BASE_FEE,\n      networkPassphrase: NETWORK_PASSPHRASE\n    }).addOperation(StellarSdk.Operation.payment({\n      destination: publicKey,\n      asset: StellarSdk.Asset.native(),\n      amount: amount.toString()\n    })).addMemo(StellarSdk.Memo.text(`TIMELOCK:${unlockTime}`)).setTimeout(30).build();\n    return transaction;\n  }\n  async createTimeLockWithFreighter(publicKey, amount, lockPeriodDays) {\n    if (!this.isFreighterAvailable()) throw new Error('Freighter is not installed');\n    const tx = await this.buildTimeLockTransaction(publicKey, amount, lockPeriodDays);\n\n    // Get XDR and ask Freighter to sign\n    const txXDR = tx.toXDR();\n    const signedXDR = await window.freighterApi.signTransaction(txXDR);\n\n    // Convert signed XDR back to a Transaction and submit\n    const signedTx = StellarSdk.Transaction.fromXDR(signedXDR, NETWORK_PASSPHRASE);\n    const result = await this.server.submitTransaction(signedTx);\n    return result.hash;\n  }\n  async withdraw(secretKey, amount) {\n    try {\n      const sourceKeypair = StellarSdk.Keypair.fromSecret(secretKey);\n      const sourcePublicKey = sourceKeypair.publicKey();\n      const account = await this.server.loadAccount(sourcePublicKey);\n      const transaction = new StellarSdk.TransactionBuilder(account, {\n        fee: StellarSdk.BASE_FEE,\n        networkPassphrase: NETWORK_PASSPHRASE\n      }).addOperation(StellarSdk.Operation.payment({\n        destination: sourcePublicKey,\n        asset: StellarSdk.Asset.native(),\n        amount: amount.toString()\n      })).addMemo(StellarSdk.Memo.text('WITHDRAW')).setTimeout(30).build();\n      transaction.sign(sourceKeypair);\n      const result = await this.server.submitTransaction(transaction);\n      return result.hash;\n    } catch (error) {\n      console.error('Withdrawal error:', error);\n      throw new Error(error.message || 'Failed to withdraw');\n    }\n  }\n  async getAccountBalance(publicKey) {\n    try {\n      const account = await this.server.loadAccount(publicKey);\n      const balance = account.balances.find(b => b.asset_type === 'native');\n      return parseFloat(balance.balance);\n    } catch (error) {\n      throw new Error('Failed to fetch balance');\n    }\n  }\n}\nexport default new StellarService();","map":{"version":3,"names":["StellarSdk","TESTNET","SERVER_URL","NETWORK_PASSPHRASE","Networks","PUBLIC","StellarService","constructor","server","Horizon","Server","createTimeLock","secretKey","amount","lockPeriodDays","sourceKeypair","Keypair","fromSecret","sourcePublicKey","publicKey","account","loadAccount","unlockTime","Math","floor","Date","now","transaction","TransactionBuilder","fee","BASE_FEE","networkPassphrase","addOperation","Operation","payment","destination","asset","Asset","native","toString","addMemo","Memo","text","setTimeout","build","sign","result","submitTransaction","hash","error","console","Error","message","isFreighterAvailable","window","freighterApi","getFreighterPublicKey","getPublicKey","buildTimeLockTransaction","createTimeLockWithFreighter","tx","txXDR","toXDR","signedXDR","signTransaction","signedTx","Transaction","fromXDR","withdraw","getAccountBalance","balance","balances","find","b","asset_type","parseFloat"],"sources":["C:/Users/Ashish Dixit/OneDrive/Desktop/stellar-timelock-savings/frontend/src/services/StellarService.js"],"sourcesContent":["import * as StellarSdk from '@stellar/stellar-sdk';\r\n\r\nconst TESTNET = true;\r\nconst SERVER_URL = TESTNET \r\n  ? 'https://horizon-testnet.stellar.org'\r\n  : 'https://horizon.stellar.org';\r\n\r\nconst NETWORK_PASSPHRASE = TESTNET\r\n  ? StellarSdk.Networks.TESTNET\r\n  : StellarSdk.Networks.PUBLIC;\r\n\r\nclass StellarService {\r\n  constructor() {\r\n    this.server = new StellarSdk.Horizon.Server(SERVER_URL);\r\n  }\r\n\r\n  async createTimeLock(secretKey, amount, lockPeriodDays) {\r\n    try {\r\n      const sourceKeypair = StellarSdk.Keypair.fromSecret(secretKey);\r\n      const sourcePublicKey = sourceKeypair.publicKey();\r\n\r\n      // Load account\r\n      const account = await this.server.loadAccount(sourcePublicKey);\r\n\r\n      // Calculate unlock time\r\n      const unlockTime = Math.floor(Date.now() / 1000) + (lockPeriodDays * 24 * 60 * 60);\r\n\r\n      // Build transaction\r\n      const transaction = new StellarSdk.TransactionBuilder(account, {\r\n        fee: StellarSdk.BASE_FEE,\r\n        networkPassphrase: NETWORK_PASSPHRASE,\r\n      })\r\n        .addOperation(\r\n          StellarSdk.Operation.payment({\r\n            destination: sourcePublicKey,\r\n            asset: StellarSdk.Asset.native(),\r\n            amount: amount.toString(),\r\n          })\r\n        )\r\n        .addMemo(StellarSdk.Memo.text(`TIMELOCK:${unlockTime}`))\r\n        .setTimeout(30)\r\n        .build();\r\n\r\n      // Sign and submit\r\n      transaction.sign(sourceKeypair);\r\n      const result = await this.server.submitTransaction(transaction);\r\n\r\n      return result.hash;\r\n    } catch (error) {\r\n      console.error('Stellar transaction error:', error);\r\n      throw new Error(error.message || 'Failed to create time-lock');\r\n    }\r\n  }\r\n\r\n  // --- Freighter integration ---\r\n  isFreighterAvailable() {\r\n    return typeof window !== 'undefined' && !!window.freighterApi;\r\n  }\r\n\r\n  async getFreighterPublicKey() {\r\n    if (!this.isFreighterAvailable()) throw new Error('Freighter not available');\r\n    return await window.freighterApi.getPublicKey();\r\n  }\r\n\r\n  // Build transaction but do not sign (returns Stellar Transaction object)\r\n  async buildTimeLockTransaction(publicKey, amount, lockPeriodDays) {\r\n    const account = await this.server.loadAccount(publicKey);\r\n\r\n    const unlockTime = Math.floor(Date.now() / 1000) + (lockPeriodDays * 24 * 60 * 60);\r\n\r\n    const transaction = new StellarSdk.TransactionBuilder(account, {\r\n      fee: StellarSdk.BASE_FEE,\r\n      networkPassphrase: NETWORK_PASSPHRASE,\r\n    })\r\n      .addOperation(\r\n        StellarSdk.Operation.payment({\r\n          destination: publicKey,\r\n          asset: StellarSdk.Asset.native(),\r\n          amount: amount.toString(),\r\n        })\r\n      )\r\n      .addMemo(StellarSdk.Memo.text(`TIMELOCK:${unlockTime}`))\r\n      .setTimeout(30)\r\n      .build();\r\n\r\n    return transaction;\r\n  }\r\n\r\n  async createTimeLockWithFreighter(publicKey, amount, lockPeriodDays) {\r\n    if (!this.isFreighterAvailable()) throw new Error('Freighter is not installed');\r\n\r\n    const tx = await this.buildTimeLockTransaction(publicKey, amount, lockPeriodDays);\r\n\r\n    // Get XDR and ask Freighter to sign\r\n    const txXDR = tx.toXDR();\r\n    const signedXDR = await window.freighterApi.signTransaction(txXDR);\r\n\r\n    // Convert signed XDR back to a Transaction and submit\r\n    const signedTx = StellarSdk.Transaction.fromXDR(signedXDR, NETWORK_PASSPHRASE);\r\n    const result = await this.server.submitTransaction(signedTx);\r\n    return result.hash;\r\n  }\r\n\r\n  async withdraw(secretKey, amount) {\r\n    try {\r\n      const sourceKeypair = StellarSdk.Keypair.fromSecret(secretKey);\r\n      const sourcePublicKey = sourceKeypair.publicKey();\r\n\r\n      const account = await this.server.loadAccount(sourcePublicKey);\r\n\r\n      const transaction = new StellarSdk.TransactionBuilder(account, {\r\n        fee: StellarSdk.BASE_FEE,\r\n        networkPassphrase: NETWORK_PASSPHRASE,\r\n      })\r\n        .addOperation(\r\n          StellarSdk.Operation.payment({\r\n            destination: sourcePublicKey,\r\n            asset: StellarSdk.Asset.native(),\r\n            amount: amount.toString(),\r\n          })\r\n        )\r\n        .addMemo(StellarSdk.Memo.text('WITHDRAW'))\r\n        .setTimeout(30)\r\n        .build();\r\n\r\n      transaction.sign(sourceKeypair);\r\n      const result = await this.server.submitTransaction(transaction);\r\n\r\n      return result.hash;\r\n    } catch (error) {\r\n      console.error('Withdrawal error:', error);\r\n      throw new Error(error.message || 'Failed to withdraw');\r\n    }\r\n  }\r\n\r\n  async getAccountBalance(publicKey) {\r\n    try {\r\n      const account = await this.server.loadAccount(publicKey);\r\n      const balance = account.balances.find(\r\n        (b) => b.asset_type === 'native'\r\n      );\r\n      return parseFloat(balance.balance);\r\n    } catch (error) {\r\n      throw new Error('Failed to fetch balance');\r\n    }\r\n  }\r\n}\r\n\r\nexport default new StellarService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}